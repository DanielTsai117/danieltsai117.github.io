<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名片上傳與辨識</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        pre { background-color: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        input[type="file"] { margin-bottom: 15px; }
    </style>
</head>
<body>
    <h1>名片上傳與辨識</h1>
    <input type="file" id="fileInput" accept="image/*" required>
    <button id="uploadBtn">上傳名片</button>

    <h2>辨識結果：</h2>
    <pre id="result"></pre>

    <script>
        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('請選擇一個檔案');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            const uploadBtn = document.getElementById('uploadBtn');
            const resultDisplay = document.getElementById('result');
            uploadBtn.disabled = true; // 禁用按鈕防止重複提交
            resultDisplay.textContent = '正在上傳並辨識中，請稍候...';

            try {
                // 將 'https://card5-614604095631.europe-west1.run.app/uploadBusinessCard'
                // 替換為您實際部署的 Cloud Function 的觸發 URL
                const response = await fetch('https://card5-614604095631.europe-west1.run.app/', { 
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();
                if (response.ok) {
                    resultDisplay.textContent = JSON.stringify(data, null, 2);
                    alert('名片辨識成功！資料已寫入 Google 試算表。');
                } else {
                    resultDisplay.textContent = `錯誤：${data.error || '未知錯誤'}`;
                    alert(`錯誤：${data.error || '未知錯誤'}`);
                }
            } catch (error) {
                console.error('上傳失敗:', error);
                resultDisplay.textContent = `上傳失敗：${error.message}`;
                alert('上傳或處理過程中發生錯誤，請檢查控制台。');
            } finally {
                uploadBtn.disabled = false; // 重新啟用按鈕
            }
        });
    </script>
</body>
</html>
